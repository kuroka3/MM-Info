#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Checking for database changes..."

if git diff --cached --name-only | grep -q "prisma/schema.prisma\|scripts/.*\.ts"; then
  echo "ğŸ“¦ Database-related files detected, creating backup..."
  npm run backup:db

  if [ $? -ne 0 ]; then
    echo "âŒ Backup failed! Push aborted."
    exit 1
  fi

  echo "âœ… Backup completed successfully!"
else
  echo "âœ“ No database changes detected, skipping backup."
fi
